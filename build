#!/bin/bash

set -e

CC=${CC:-gcc}

go install -v github.com/google/wuffs/cmd/wuffs-c
export WUFFSROOT=$(go list -m -f {{.Dir}} github.com/google/wuffs)

wuffs-c gen -package_name zstd decode.wuffs consts.wuffs >decode.h

rm -f wuffs-base.h
cp $WUFFSROOT/release/c/wuffs-v0.2.h wuffs-base.h

$CC -x c -DWUFFS_IMPLEMENTATION wuffs-base.h wuffsmain.c -o zstd

rm -f decode.h
